<?xml version="1.0" encoding="UTF-8"?>
<sequence name="sequence-load-config" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <property description="CODE_LOC 00" name="CODE_LOC" scope="default" type="STRING" value="sequence-load-config step 00"/>
    <!-- SEQUENCE STEP LOGGING -->
    <call-template description="make log call" target="common-ct-logging-template">
        <with-param name="MESSAGE_PARAM" value="ENTER sequence-load-config"/>
    </call-template>
    <property description="CODE_LOC 01" name="CODE_LOC" scope="default" type="STRING" value="sequence-load-config step 01"/>
    <!-- Call to the template to load particular journey config file-->
    <call-template target="get-config-from-cache-template">
        <with-param name="journey" value="APINAME1"/>
        <with-param name="version" value="{$ctx:APIVersion}"/>
    </call-template>
    <!-- GET ETMP BACKEND URL -->
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/protocol" name="BCKEND_EP_PROTOCOL" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/host" name="BCKEND_EP_HOST" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/port" name="BCKEND_EP_PORT" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/url" name="BCKEND_EP_URL" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/headers/header[name='Accept']/value" name="BCKEND_EP_HEADER_ACCEPT" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/headers/header[name='messageType']/value" name="BCKEND_EP_HEADER_MESSAGE_TYPE" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/headers/header[name='ContentType']/value" name="BCKEND_EP_HEADER_CONTENT_TYPE" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/headers/header[name='SOAPAction']/value" name="BCKEND_EP_HEADER_SOAP_ACTION" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <!-- GET BCKEND CREDENTIALS DATA -->
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/username" name="BCKEND_EP_USERNAME" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/endpoint[@id='ESB-APINAME1-BCKEND-ENDPOINT']/password" name="BCKEND_EP_PASSWORD" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <!-- 02 GETTING ENDPOINT -->
    <property description="CODE_LOC 02" name="CODE_LOC" scope="default" type="STRING" value="sequence-load-config step 02"/>
    <property description="getting adapter address" expression="fn:concat($ctx:BCKEND_EP_PROTOCOL, '://', $ctx:BCKEND_EP_HOST, ':', $ctx:BCKEND_EP_PORT, $ctx:BCKEND_EP_URL)" name="uri.var.backend.address" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <call-template description="make log call" target="common-ct-logging-template">
        <with-param name="MESSAGE_PARAM" value="{fn:concat('BACKEND URL: ',  $ctx:uri.var.s129.ct.backend.address)}"/>
    </call-template>
    <!-- 04 ESTABLISHING the type of in-coming message -->
    <!-- Loading microservice input parameters from service config -->
    <property expression="$ctx:APINAME1/service[@id='EIS']/@systemName" name="INPUT_SYSTEM_NAME" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/service[@id='EIS']/@serviceName" name="INPUT_SERVICE_NAME" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/service[@id='EIS']/@serviceVersion" name="INPUT_SERVICE_VERSION" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <!-- Loading microservice output parameters from service config -->
    <property expression="$ctx:APINAME1/service[@id='BCKEND']/@systemName" name="BCKEND_OUTPUT_SYSTEM_NAME" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/service[@id='BCKEND']/@serviceName" name="BCKEND_OUTPUT_SERVICE_NAME" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <property expression="$ctx:APINAME1/service[@id='BCKEND']/@serviceVersion" name="BCKEND_OUTPUT_SERVICE_VERSION" scope="default" type="STRING" xmlns:ns="http://org.apache.synapse/xsd"/>
    <!-- SEQUENCE STEP LOGGING -->
    <property description="CODE_LOC 99" name="CODE_LOC" scope="default" type="STRING" value="sequence-load-config step 99"/>
    <call-template description="leave load config sequence" target="logging-template">
        <with-param name="MESSAGE_PARAM" value="LEAVE sequence-load-config"/>
    </call-template>
</sequence>
